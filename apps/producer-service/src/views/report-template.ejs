<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Cycle Report — <%= cycle.name %></title>
  <style>
    /* ── Reset & base ─────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    @page {
      size: A4;
      margin: 20mm 16mm 28mm 16mm; /* extra bottom for footer */
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      font-size: 11px;
      line-height: 1.5;
      color: #e2e8f0;        /* slate-200 */
      background: #0d1117;   /* gh-bg-dark */
    }

    /* ── Page-break helpers ───────────────────────────────────────── */
    .no-break  { break-inside: avoid; }
    .page-break { break-before: page; }

    /* ── Fixed footer printed on every page ───────────────────────── */
    @page {
      @bottom-center {
        content: "Confidential — Generated by Agnostic Automation Center  |  Page " counter(page) " of " counter(pages);
        font-size: 9px;
        color: #64748b;
      }
    }
    /* Fallback footer element for Playwright (which renders @page content correctly,
       but we add an HTML footer too for visual fidelity) */
    .page-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: #475569;         /* slate-600 */
      border-top: 1px solid #1e293b;
      background: #0d1117;
    }

    /* ── Header ───────────────────────────────────────────────────── */
    .report-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 16px;
      margin-bottom: 20px;
      border-bottom: 2px solid #7c3aed; /* violet-700 */
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-logo {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #7c3aed, #4f46e5);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .brand-text h1 {
      font-size: 15px;
      font-weight: 700;
      color: #f1f5f9;
    }
    .brand-text p {
      font-size: 9px;
      color: #7c3aed;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 600;
    }
    .report-meta {
      text-align: right;
    }
    .report-meta h2 {
      font-size: 13px;
      font-weight: 600;
      color: #f1f5f9;
      max-width: 260px;
      word-break: break-word;
    }
    .report-meta .meta-row {
      font-size: 9px;
      color: #94a3b8;
      margin-top: 3px;
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 99px;
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .status-PENDING  { background: #451a03; color: #fbbf24; border: 1px solid #92400e; }
    .status-RUNNING  { background: #0c1a3d; color: #60a5fa; border: 1px solid #1e3a8a; }
    .status-COMPLETED { background: #052e16; color: #4ade80; border: 1px solid #166534; }

    /* ── Section titles ───────────────────────────────────────────── */
    .section-title {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #7c3aed;
      margin-bottom: 10px;
      padding-bottom: 4px;
      border-bottom: 1px solid #1e293b;
    }

    /* ── Summary cards ────────────────────────────────────────────── */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 22px;
    }
    .stat-card {
      background: #161b22; /* gh-bg-subtle-dark */
      border: 1px solid #21262d;
      border-radius: 10px;
      padding: 14px 12px;
    }
    .stat-card .stat-value {
      font-size: 28px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: 4px;
    }
    .stat-card .stat-label {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      font-weight: 600;
    }
    .stat-total   { color: #a5b4fc; } /* violet-300 */
    .stat-passed  { color: #4ade80; } /* green-400  */
    .stat-failed  { color: #f87171; } /* red-400    */
    .stat-auto    { color: #818cf8; } /* indigo-400 */

    /* ── Automation split ─────────────────────────────────────────── */
    .split-section {
      margin-bottom: 22px;
    }
    .split-bars {
      display: flex;
      gap: 16px;
      align-items: stretch;
    }
    .split-bar-item {
      flex: 1;
      background: #161b22;
      border: 1px solid #21262d;
      border-radius: 10px;
      padding: 14px 12px;
    }
    .split-bar-item .bar-label {
      font-size: 10px;
      font-weight: 600;
      color: #cbd5e1;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .dot-automated { width: 8px; height: 8px; border-radius: 50%; background: #38bdf8; display: inline-block; }
    .dot-manual    { width: 8px; height: 8px; border-radius: 50%; background: #a78bfa; display: inline-block; }
    .bar-track {
      width: 100%;
      height: 8px;
      background: #1e293b;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 6px;
    }
    .bar-fill-auto   { height: 100%; background: linear-gradient(90deg, #0ea5e9, #38bdf8); border-radius: 4px; }
    .bar-fill-manual { height: 100%; background: linear-gradient(90deg, #7c3aed, #a78bfa); border-radius: 4px; }
    .bar-stats {
      display: flex;
      justify-content: space-between;
      font-size: 9px;
      color: #64748b;
    }

    /* ── Detailed test log ────────────────────────────────────────── */
    .log-section {
      margin-bottom: 24px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
    }
    thead tr {
      background: #161b22;
    }
    thead th {
      padding: 8px 10px;
      text-align: left;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #64748b;
      border-bottom: 1px solid #21262d;
    }
    tbody tr {
      border-bottom: 1px solid #1e293b;
      break-inside: avoid;
    }
    tbody tr:last-child { border-bottom: none; }
    tbody td {
      padding: 7px 10px;
      color: #cbd5e1;
      vertical-align: top;
    }
    .td-index {
      color: #475569;
      font-variant-numeric: tabular-nums;
      width: 32px;
    }
    .td-title { max-width: 200px; word-break: break-word; }
    .td-type  { white-space: nowrap; }
    .type-badge {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 1px 7px;
      border-radius: 4px;
      font-size: 9px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .type-AUTOMATED { background: #0c2a3d; color: #38bdf8; border: 1px solid #0369a1; }
    .type-MANUAL    { background: #1e0a3d; color: #a78bfa; border: 1px solid #5b21b6; }

    .item-status-badge {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 1px 7px;
      border-radius: 4px;
      font-size: 9px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .item-PENDING  { background: #1e293b; color: #94a3b8; }
    .item-RUNNING  { background: #0c1a3d; color: #60a5fa; }
    .item-PASSED   { background: #052e16; color: #4ade80; }
    .item-FAILED   { background: #2d0a0a; color: #f87171; }
    .item-ERROR    { background: #2d0a0a; color: #f87171; }
    .item-SKIPPED  { background: #1c0f00; color: #fbbf24; }

    .steps-table {
      margin-top: 4px;
      width: 100%;
      border-collapse: collapse;
    }
    .steps-table th {
      font-size: 8px;
      color: #475569;
      padding: 3px 6px;
      background: #0d1117;
      border-bottom: 1px solid #21262d;
    }
    .steps-table td {
      font-size: 9px;
      color: #94a3b8;
      padding: 3px 6px;
      border-bottom: 1px solid #1e293b;
      vertical-align: top;
    }
    .steps-table tr:last-child td { border-bottom: none; }
    .step-comment {
      font-style: italic;
      color: #64748b;
      font-size: 8px;
    }

    /* ── Alternating row background for readability ───────────────── */
    tbody tr:nth-child(even) td {
      background: #0f1923;
    }
  </style>
</head>
<body>

  <!-- ─── Page footer (fixed) ──────────────────────────────────────── -->
  <div class="page-footer">
    Confidential — Generated by Agnostic Automation Center &nbsp;|&nbsp; Cycle: <%= cycle.name %>
  </div>

  <!-- ─── Report header ────────────────────────────────────────────── -->
  <div class="report-header no-break">
    <div class="brand">
      <div class="brand-logo">A</div>
      <div class="brand-text">
        <h1>Agnostic Automation Center</h1>
        <p>Quality Hub · Test Cycle Report</p>
      </div>
    </div>
    <div class="report-meta">
      <h2><%= cycle.name %></h2>
      <div class="meta-row">
        <span class="status-badge status-<%= cycle.status %>"><%= cycle.status %></span>
      </div>
      <div class="meta-row">
        Generated: <%= generatedAt %> &nbsp;·&nbsp; ID: <%= cycleId %>
      </div>
      <% if (projectId) { %>
      <div class="meta-row">Project: <%= projectId %></div>
      <% } %>
    </div>
  </div>

  <!-- ─── Section 1: Summary dashboard ─────────────────────────────── -->
  <div class="section-title">Summary Dashboard</div>
  <div class="summary-grid no-break">
    <div class="stat-card">
      <div class="stat-value stat-total"><%= summary.total %></div>
      <div class="stat-label">Total Tests</div>
    </div>
    <div class="stat-card">
      <div class="stat-value stat-passed"><%= summary.passed %></div>
      <div class="stat-label">Passed</div>
    </div>
    <div class="stat-card">
      <div class="stat-value stat-failed"><%= summary.failed %></div>
      <div class="stat-label">Failed</div>
    </div>
    <div class="stat-card">
      <div class="stat-value stat-auto"><%= summary.automationRate %>%</div>
      <div class="stat-label">Automation Rate</div>
    </div>
  </div>

  <!-- ─── Section 2: Automation vs Manual split ─────────────────────── -->
  <div class="split-section no-break">
    <div class="section-title">Automation vs Manual Split</div>
    <div class="split-bars">

      <!-- Automated bar -->
      <div class="split-bar-item">
        <div class="bar-label">
          <span class="dot-automated"></span> Automated
        </div>
        <div class="bar-track">
          <div class="bar-fill-auto" style="width: <%= summary.automationRate %>%"></div>
        </div>
        <div class="bar-stats">
          <span><%= automatedCount %> test<%= automatedCount !== 1 ? 's' : '' %></span>
          <span><%= summary.automationRate %>%</span>
        </div>
      </div>

      <!-- Manual bar -->
      <div class="split-bar-item">
        <div class="bar-label">
          <span class="dot-manual"></span> Manual
        </div>
        <div class="bar-track">
          <div class="bar-fill-manual" style="width: <%= manualRate %>%"></div>
        </div>
        <div class="bar-stats">
          <span><%= manualCount %> test<%= manualCount !== 1 ? 's' : '' %></span>
          <span><%= manualRate %>%</span>
        </div>
      </div>

      <!-- Pass rate bar -->
      <div class="split-bar-item">
        <div class="bar-label">Pass Rate</div>
        <div class="bar-track">
          <div class="bar-fill-auto" style="width: <%= passRate %>%; background: linear-gradient(90deg, #16a34a, #4ade80);"></div>
        </div>
        <div class="bar-stats">
          <span><%= summary.passed %> passed / <%= summary.failed %> failed</span>
          <span><%= passRate %>%</span>
        </div>
      </div>

    </div>
  </div>

  <!-- ─── Section 3: Detailed test log ─────────────────────────────── -->
  <div class="log-section">
    <div class="section-title">Detailed Test Log</div>

    <% if (items.length === 0) { %>
      <p style="color:#475569; font-size:10px; padding:12px 0;">No test items recorded in this cycle.</p>
    <% } else { %>
    <table>
      <thead>
        <tr>
          <th class="td-index">#</th>
          <th style="min-width:180px;">Test Title</th>
          <th>Type</th>
          <th>Status</th>
          <th style="min-width:140px;">Manual Steps</th>
          <th>Execution ID</th>
        </tr>
      </thead>
      <tbody>
        <% items.forEach(function(item, idx) { %>
        <tr class="no-break">
          <td class="td-index"><%= idx + 1 %></td>
          <td class="td-title"><%= item.title %></td>
          <td class="td-type">
            <span class="type-badge type-<%= item.type %>"><%= item.type %></span>
          </td>
          <td>
            <span class="item-status-badge item-<%= item.status %>"><%= item.status %></span>
          </td>
          <td>
            <% if (item.manualSteps && item.manualSteps.length > 0) { %>
            <table class="steps-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Action</th>
                  <th>Expected</th>
                  <th>Result</th>
                </tr>
              </thead>
              <tbody>
                <% item.manualSteps.forEach(function(step, sIdx) { %>
                <tr>
                  <td><%= sIdx + 1 %></td>
                  <td><%= step.action %></td>
                  <td><%= step.expectedResult %></td>
                  <td>
                    <span class="item-status-badge item-<%= step.status %>"><%= step.status %></span>
                    <% if (step.comment) { %>
                    <div class="step-comment"><%= step.comment %></div>
                    <% } %>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
            <% } else { %>
            <span style="color:#475569;">—</span>
            <% } %>
          </td>
          <td style="font-size:8px; color:#475569; word-break:break-all;">
            <% if (item.executionId) { %><%= item.executionId %><% } else { %>—<% } %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <% } %>
  </div>

</body>
</html>
