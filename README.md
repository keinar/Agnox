# ðŸš€ Playwright Full-Stack Automation Framework

A robust, microservices-based test automation platform designed for **scalability**, **real-time reporting**, and **AI-driven analysis**.

![Architecture](https://img.shields.io/badge/Architecture-Microservices-blue?style=flat-square)
![CI/CD](https://img.shields.io/badge/CI%2FCD-GitHub%20Actions-green?style=flat-square)
![Docker](https://img.shields.io/badge/Docker-Compose-2496ED?style=flat-square)
![AI](https://img.shields.io/badge/AI-Gemini%20Pro-orange?style=flat-square)

---

## ðŸ—ï¸ Architecture

The system is built using a modern event-driven architecture to ensure decoupling between test execution, reporting, and management.

### Services Overview

- **ðŸ–¥ï¸ Dashboard Client (`apps/dashboard-client`)**
  - Built with **React**, **Vite**, and **Tailwind CSS**.
  - Real-time UI for viewing test executions, logs, and statistics.
  - Uses **Socket.io** for live updates.

- **âš™ï¸ Producer Service (`apps/producer-service`)**
  - High-performance API Gateway built with **Fastify**.
  - Handles HTTP requests and manages **MongoDB** connections.
  - Publishes execution tasks to **RabbitMQ**.

- **ðŸ‘· Worker Service (`apps/worker-service`)**
  - The core execution engine (Node.js).
  - Consumes tasks from **RabbitMQ** and executes **Playwright** tests.
  - Integrates **Google Gemini AI** for intelligent error analysis.
  - Generates **Allure Reports** for detailed test visualization.

---

## ðŸ› ï¸ Tech Stack

- **Frontend:** React, TypeScript, Recharts, Framer Motion
- **Backend:** Node.js, Fastify, Socket.io
- **Testing:** Playwright, Allure Report
- **Infrastructure:** Docker, Docker Compose, RabbitMQ, MongoDB
- **CI/CD:** GitHub Actions
- **AI:** Google Gemini (Generative AI)

---

## ðŸ’» Getting Started

### Prerequisites

* Docker & Docker Compose
* Node.js (v18+)
* Oracle Cloud Account (for Deployment)
* Google Gemini API Key

### Local Setup

1. **Clone the repository:**
   ```bash
   git clone https://github.com/keinar/playwright-full-stack-framework.git
   cd playwright-full-stack-framework
   ```

2. **Environment Configuration:**
   Create a `.env` file in the root directory:
   ```env
   MONGO_URI=mongodb://mongo:27017/automation
   RABBITMQ_URL=amqp://rabbitmq
   GEMINI_API_KEY=your_api_key_here
   BASE_URL=https://automation.keinar.com
   ADMIN_USER=admin
   ADMIN_PASS=securepass
   ```

3. **Run with Docker Compose:**
   ```bash
   docker compose up -d --build
   ```

4. **Access Services:**
   - **Dashboard:** http://localhost:8080
   - **Producer API:** http://localhost:3000
   - **RabbitMQ UI:** http://localhost:15672 (guest/guest)

---

## â˜ï¸ Deployment & CI/CD

This project features a unified **CI/CD pipeline** (`deploy.yml`) using GitHub Actions for seamless deployment to Oracle Cloud.

### Pipeline Flow
1. **Quality Check:** Runs linting and unit tests.
2. **Deploy:** Connects via SSH, pulls the latest code, and rebuilds containers directly on the server (optimized for ARM/Ampere architecture).
3. **Cleanup:** Prunes unused Docker images.

### Required GitHub Secrets

| Secret Name | Description |
| :--- | :--- |
| `VPS_HOST` | Server IP Address |
| `VPS_USER` | Server Username (e.g., `ubuntu`) |
| `VPS_SSH_KEY` | Private SSH Key |
| `MONGO_URI` | MongoDB Connection String |
| `GEMINI_API_KEY` | Google Gemini API Key |

---

## ðŸ¹ "The Hunter" - Oracle Cloud Auto-Scaler

Included is a specialized script (`hunter.sh`) designed to **automatically hunt and provision** the free-tier **Ampere A1 Compute Instance** (4 OCPUs, 24GB RAM) on Oracle Cloud.

### How it works
- Scans all Availability Domains (AD-1, AD-2, AD-3).
- Retries intelligently to avoid API rate limits.
- Provisions the server as soon as capacity is available.

**Usage:**
```bash
nohup ./hunter.sh > hunter.log 2>&1 &
```

---

## ðŸ§ª Running Tests

### Option 1: Via Dashboard

Navigate to `http://localhost:8080`, select a test suite, and click **Run**.

### Option 2: Manual Trigger (CLI)

```bash
docker compose exec worker npx playwright test
```

### Option 3: Via API

```bash
curl -X POST http://localhost:3000/execution-request   -H "Content-Type: application/json"   -d '{"config": {"baseUrl": "https://example.com"}, "tests": ["tests/e2e/login.spec.ts"]}'
```

---

## ðŸ“Š Reporting

The system provides two layers of reporting:

1. **Real-time Dashboard:** Live status updates via Socket.io.
2. **Allure Reports:** Detailed historical reports generated by the worker.

---

## ðŸ“œ License

MIT License
